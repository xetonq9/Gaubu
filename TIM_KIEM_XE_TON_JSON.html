
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tìm kiếm dữ liệu xe tồn</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; margin: 0; }
    h2 { text-align: center; font-size: 1.5em; }
    input[type="text"] {
      width: 100%; padding: 10px; font-size: 16px; margin: 10px 0; box-sizing: border-box;
    }
    table {
      border-collapse: collapse; width: 100%; font-size: 12px; overflow-x: auto; display: block;
    }
    th, td {
      border: 1px solid #ccc; padding: 6px; text-align: left; white-space: nowrap;
    }
    .highlight { background-color: yellow; font-weight: bold; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    #counter { margin: 8px 0; font-size: 14px; }
  </style>
</head>
<body>
  <h2>TÌM KIẾM DỮ LIỆU XE TỒN</h2>
  <input type="text" id="search" placeholder="Nhập từ khóa tìm kiếm...">
  <p id="counter">Đang tải dữ liệu...</p>
  <div style="overflow-x:auto;">
    <table id="data-table">
      <thead id="table-head"></thead>
      <tbody id="table-body"></tbody>
    </table>
  </div>

  <script>
    function normalize(str) {
      return str.normalize("NFD").replace(/[̀-ͯ]/g, "").replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
    }

    function buildTable(data) {
      const headEl = document.getElementById("table-head");
      const bodyEl = document.getElementById("table-body");
      const keys = Object.keys(data[0]);

      headEl.innerHTML = "<tr>" + keys.map(k => `<th>${k}</th>`).join('') + "</tr>";

      bodyEl.innerHTML = data.map(row => {
        return "<tr>" + keys.map(k => `<td>${row[k]}</td>`).join('') + "</tr>";
      }).join('');
    }

    function applySearch(keyword) {
      const rows = document.querySelectorAll("tbody tr");
      const normKeyword = normalize(keyword.trim());
      let count = 0;

      rows.forEach(row => {
        let matched = false;
        const cells = row.querySelectorAll("td");

        cells.forEach(cell => {
          const norm = normalize(cell.innerText);
          if (norm.includes(normKeyword)) matched = true;
        });

        if ((keyword === "" || matched) && count < 50) {
          row.style.display = "";
          count++;
          cells.forEach(cell => {
            const text = cell.innerText;
            const normText = normalize(text);
            if (normKeyword && normText.includes(normKeyword)) {
              cell.innerHTML = `<span class="highlight">${cell.innerText}</span>`;
            } else {
              cell.innerHTML = cell.innerText;
            }
          });
        } else {
          row.style.display = "none";
        }
      });

      document.getElementById("counter").innerText = "Hiển thị " + count + " dòng phù hợp";
    }

    // Tải dữ liệu JSON và xây bảng
    fetch("du_lieu_xe_ton.json")
      .then(response => response.json())
      .then(data => {
        buildTable(data);
        document.getElementById("search").addEventListener("input", e => {
          applySearch(e.target.value);
        });
        applySearch("");
      })
      .catch(err => {
        document.getElementById("counter").innerText = "Lỗi tải dữ liệu!";
        console.error("Lỗi tải dữ liệu JSON", err);
      });
  </script>
</body>
</html>
