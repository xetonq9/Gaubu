
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nh·∫≠p d·ªØ li·ªáu Google Sheet</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
    input, button, textarea { margin: 5px 0; padding: 8px; width: 100%; box-sizing: border-box; }
    button { background-color: green; color: white; font-weight: bold; border: none; cursor: pointer; }
    .success { color: green; margin-top: 10px; }
    .error { color: red; margin-top: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; overflow-x: auto; display: block; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; white-space: nowrap; }
    .highlight { background-color: yellow; }
  </style>
</head>
<body>
  <h2>üì• Nh·∫≠p d·ªØ li·ªáu v√†o Google Sheet</h2>
  <form id="dataForm">
    <input type="text" name="vehicle" placeholder="Lo·∫°i xe">
    <input type="text" name="plate" placeholder="Bi·ªÉn s·ªë xe">
    <input type="text" name="name" placeholder="H·ªç v√† t√™n">
    <input type="text" name="birth" placeholder="NƒÉm sinh">
    <input type="text" name="address" placeholder="ƒê·ªãa ch·ªâ">
    <input type="text" name="action" placeholder="H√†nh vi">
    <textarea name="note" placeholder="N·ªôi dung kh√°c"></textarea>
    <button type="submit">‚ûï G·ª≠i d·ªØ li·ªáu</button>
  </form>
  <div id="responseMsg"></div>

  <h2>üîç T√¨m ki·∫øm trong danh s√°ch</h2>
  <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ l·ªçc...">

  <table id="dataTable">
    <thead>
      <tr>
        <th>STT</th>
        <th>Lo·∫°i xe</th>
        <th>Bi·ªÉn s·ªë xe</th>
        <th>H·ªç v√† t√™n</th>
        <th>NƒÉm sinh</th>
        <th>ƒê·ªãa ch·ªâ</th>
        <th>H√†nh vi</th>
        <th>N·ªôi dung kh√°c</th>
        <th>Ng√†y nh·∫≠p</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    const form = document.getElementById("dataForm");
    const responseMsg = document.getElementById("responseMsg");
    const searchInput = document.getElementById("searchInput");
    const tableBody = document.getElementById("tableBody");

    const scriptURL = "https://script.google.com/macros/s/AKfycbxMyLf_B__k2WfiUCAmSoyCvdy2BJ2q29ZJh-58k03HzQVFsgW_0SetyVLAgWPZI5s6wQ/exec";
    const sheetJSONUrl = "https://docs.google.com/spreadsheets/d/1O0SSDXg325sd-wmFYEcLriptZOgCaWpvr6Nk45ucgto/gviz/tq?tqx=out:json";

    form.addEventListener("submit", e => {
      e.preventDefault();
      const formData = new FormData(form);
      const data = {};
      formData.forEach((value, key) => data[key] = value);

      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(response => {
        responseMsg.innerHTML = "<p class='success'>‚úÖ G·ª≠i th√†nh c√¥ng!</p>";
        form.reset();
        setTimeout(loadSheetData, 1000); // c·∫≠p nh·∫≠t b·∫£ng sau khi g·ª≠i
      })
      .catch(error => {
        console.error("Error!", error.message);
        responseMsg.innerHTML = "<p class='error'>‚ùå G·ª≠i th·∫•t b·∫°i. Ki·ªÉm tra l·∫°i k·∫øt n·ªëi ho·∫∑c URL Web App.</p>";
      });
    });

    function normalize(str) {
      return str.toLowerCase().normalize("NFD")
        .replace(/[ÃÄ-ÕØ]/g, "")
        .replace(/[\.\-\s]/g, "")
        .replace(/ƒë/g, "d").replace(/[^a-z0-9]/g, '');
    }

    function loadSheetData() {
      fetch(sheetJSONUrl)
        .then(res => res.text())
        .then(text => {
          const json = JSON.parse(text.substr(47).slice(0, -2));
          const rows = json.table.rows;
          tableBody.innerHTML = "";
          rows.slice(0, 50).forEach((row, index) => {
            const tr = document.createElement("tr");
            row.c = row.c || [];
            tr.innerHTML = `
              <td>${index + 1}</td>
              <td>${row.c[0]?.v || ""}</td>
              <td>${row.c[1]?.v || ""}</td>
              <td>${row.c[2]?.v || ""}</td>
              <td>${row.c[3]?.v || ""}</td>
              <td>${row.c[4]?.v || ""}</td>
              <td>${row.c[5]?.v || ""}</td>
              <td>${row.c[6]?.v || ""}</td>
              <td>${row.c[7]?.v || ""}</td>
            `;
            tableBody.appendChild(tr);
          });
          filterTable();
        });
    }

    function filterTable() {
      const keyword = normalize(searchInput.value);
      const rows = tableBody.getElementsByTagName("tr");
      Array.from(rows).forEach(row => {
        let match = false;
        Array.from(row.cells).forEach(cell => {
          const content = cell.textContent;
          const norm = normalize(content);
          if (keyword && norm.includes(keyword)) {
            cell.classList.add("highlight");
            match = true;
          } else {
            cell.classList.remove("highlight");
          }
        });
        row.style.display = (!keyword || match) ? "" : "none";
      });
    }

    searchInput.addEventListener("input", filterTable);

    window.onload = loadSheetData;
  </script>
</body>
</html>
