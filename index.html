
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nh·∫≠p d·ªØ li·ªáu v√†o Google Sheet</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; background: #f9f9f9; }
    input, textarea, button { display: block; width: 100%; margin-top: 10px; padding: 10px; font-size: 16px; }
    button { background-color: green; color: white; border: none; cursor: pointer; }
    button:hover { background-color: darkgreen; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
    .highlight { background-color: yellow; }
  </style>
</head>
<body>
  <h2>Nh·∫≠p d·ªØ li·ªáu v√†o Google Sheet</h2>
  <form id="dataForm">
    <input type="text" name="loai_xe" placeholder="Lo·∫°i xe">
    <input type="text" name="bien_so" placeholder="Bi·ªÉn s·ªë xe">
    <input type="text" name="ho_va_ten" placeholder="H·ªç v√† t√™n">
    <input type="text" name="nam_sinh" placeholder="NƒÉm sinh">
    <input type="text" name="dia_chi" placeholder="ƒê·ªãa ch·ªâ">
    <input type="text" name="hanh_vi" placeholder="H√†nh vi">
    <textarea name="noi_dung_khac" placeholder="N·ªôi dung kh√°c"></textarea>
    <input type="text" name="ngay_nhap" placeholder="Ng√†y nh·∫≠p (dd/mm/yyyy)">
    <button type="submit">+ G·ª≠i d·ªØ li·ªáu</button>
  </form>

  <h3>üîç T√¨m ki·∫øm d·ªØ li·ªáu</h3>
  <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a ƒë·ªÉ l·ªçc..." style="width: 100%; padding: 10px; margin-top: 10px;">

  <table id="dataTable">
    <thead></thead>
    <tbody></tbody>
  </table>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyayvra-AfSHm5umHIbgM4sIjPVj7BsvkV9F3vHEtVZuyfNEuDmIgVdBV2nPSB5OTux/exec';

    document.getElementById('dataForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      fetch(scriptURL, { method: 'POST', body: formData })
        .then(response => {
          alert("‚úÖ G·ª≠i d·ªØ li·ªáu th√†nh c√¥ng!");
          this.reset();
          loadData();
        })
        .catch(error => alert("‚ùå L·ªói g·ª≠i: " + error.message));
    });

    function simplify(text) {
      return text.toLowerCase().normalize("NFD").replace(/[ÃÄ-ÕØ\s\.\-]/g, "");
    }

    function highlight(text, keyword) {
      const simpKeyword = simplify(keyword);
      const simpText = simplify(text);
      if (simpKeyword && simpText.includes(simpKeyword)) {
        return '<span class="highlight">' + text + '</span>';
      }
      return text;
    }

    function renderTable(data, keyword = "") {
      const table = document.getElementById("dataTable");
      const thead = table.querySelector("thead");
      const tbody = table.querySelector("tbody");
      thead.innerHTML = "";
      tbody.innerHTML = "";
      if (data.length === 0) return;

      const headers = Object.keys(data[0]);
      thead.innerHTML = "<tr>" + headers.map(h => "<th>" + h + "</th>").join("") + "</tr>";

      let shown = 0;
      for (const row of data) {
        if (shown >= 50) break;
        const values = headers.map(h => row[h] || "");
        const matched = values.some(v => simplify(v).includes(simplify(keyword)));
        if (!keyword || matched) {
          const htmlRow = "<tr>" + values.map(v => "<td>" + highlight(v, keyword) + "</td>").join("") + "</tr>";
          tbody.innerHTML += htmlRow;
          shown++;
        }
      }
    }

    async function loadData(keyword = "") {
      try {
        const res = await fetch(scriptURL);
        const json = await res.json();
        renderTable(json.data, keyword);
      } catch (e) {
        console.error("Fetch error:", e);
      }
    }

    document.getElementById("searchInput").addEventListener("input", function() {
      loadData(this.value);
    });

    loadData();
  </script>
</body>
</html>
